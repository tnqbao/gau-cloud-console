import Link from "next/link";
import NextImage from "next/image";
import { useRouter } from "next/router";
import { useState } from "react";
import { useAuth } from "@/contexts/AuthContext";
import { Button } from "@/components/ui/Button";
import { cn } from "@/lib/utils";

// Navigation items with icons
const navItems = [
	{
		href: "/dashboard",
		label: "Overview",
		exact: true,
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
				/>
			</svg>
		),
	},
	{
		href: "/dashboard/storage",
		label: "Object Storage",
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"
				/>
			</svg>
		),
	},
	{
		href: "/dashboard/iam",
		label: "IAM",
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
				/>
			</svg>
		),
	},
	{
		href: "/dashboard/compute",
		label: "Compute",
		comingSoon: true,
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"
				/>
			</svg>
		),
	},
	{
		href: "/dashboard/container",
		label: "Container",
		comingSoon: true,
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
				/>
			</svg>
		),
	},
	{
		href: "/dashboard/kubernetes",
		label: "Kubernetes Namespace",
		comingSoon: true,
		icon: (
			<svg
				className="w-5 h-5"
				viewBox="0 0 16 16"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="m7.567 8.5945 0.4325 0.208 0.4315 -0.2075 0.107 -0.4655 -0.2985 -0.3735 -0.4805 0 -0.2995 0.3725 0.1075 0.466z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m7.1083 6.94 0.0012 0.00095a0.26195 0.26195 0 0 0 0.41605 -0.20065l0 -0.0015 0.00635 -0.00315 0.0891 -1.57065c-0.10865 0.0134 -0.215 0.03175 -0.31665 0.0547a3.1 3.1 0 0 0 -1.48635 0.8088l1.2876 0.91285Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m6.41735 8.1311 0.0015 -0.0005a0.26205 0.26205 0 0 0 0.103 -0.4504l-0.0012 -0.001 0.00145 -0.00635 -1.17575 -1.05175a3.08875 3.08875 0 0 0 -0.4373 1.95l1.5071 -0.435Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="M6.93225 9.2505a0.26145 0.26145 0 0 0 -0.30295 -0.19945l-0.0017 0 -0.00245 -0.00315 -1.5454 0.26245a3.1026 3.1026 0 0 0 1.24315 1.5554l0.5986 -1.44675 -0.00435 -0.00585 0.00045 -0.0015a0.2592 0.2592 0 0 0 0.01465 -0.16115Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m8.2311 9.82155 -0.00075 -0.00125a0.265 0.265 0 0 0 -0.24 -0.13795 0.26345 0.26345 0 0 0 -0.2217 0.13845l-0.00075 0.00145h-0.0014l-0.76 1.37405a3.11385 3.11385 0 0 0 1.69 0.08615c0.1035 -0.0234 0.205 -0.052 0.3022 -0.0842l-0.7617 -1.3767Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m9.36855 9.045 -0.0017 0a0.255 0.255 0 0 0 -0.0603 -0.0044 0.26315 0.26315 0 0 0 -0.2273 0.36595l0.0005 0.0012 -0.002 0.0027 0.605 1.4617A3.0925 3.0925 0 0 0 10.93 9.305l-1.5588 -0.26345Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m10.64465 6.62185 -1.16915 1.04635 0.0007 0.0032 -0.0012 0.00095a0.26245 0.26245 0 0 0 0.10275 0.4507l0.00175 0.00025 0.0012 0.0066 1.51465 0.436a3.14575 3.14575 0 0 0 -0.4507 -1.94405Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m8.46915 6.73365 0 0.00145a0.25805 0.25805 0 0 0 0.05715 0.15185 0.2618 0.2618 0 0 0 0.3596 0.04835l0.00125 -0.00095 0.0044 0.00195 1.2793 -0.907a3.11535 3.11535 0 0 0 -1.792 -0.86425l0.08885 1.56785Z" fill="currentColor" strokeWidth="0.5"></path>
				<path d="m15.1903 9.5188 -1.2395 -5.38355a0.95285 0.95285 0 0 0 -0.519 -0.6455L8.415 1.09425a0.9666 0.9666 0 0 0 -0.8328 0L2.5663 3.49095a0.9536 0.9536 0 0 0 -0.51905 0.6455L0.8097 9.52a0.945 0.945 0 0 0 0.1303 0.7295 0.9182 0.9182 0 0 0 0.0544 0.0757l3.47195 4.3169a0.9622 0.9622 0 0 0 0.75 0.3579l5.56785 -0.0012a0.96255 0.96255 0 0 0 0.75 -0.35745l3.4708 -4.3174a0.94555 0.94555 0 0 0 0.1853 -0.80515Zm-1.90575 -0.065a0.3216 0.3216 0 0 1 -0.3906 0.22145l-0.00195 0 -0.00245 -0.0005 -0.00345 -0.00095 -0.0024 -0.001 -0.0286 -0.00585c-0.0173 -0.0034 -0.035 -0.0071 -0.04905 -0.01075a1.23215 1.23215 0 0 1 -0.17945 -0.0664c-0.0288 -0.01245 -0.0586 -0.02565 -0.09035 -0.0376l-0.00875 -0.00315a2.7596 2.7596 0 0 0 -0.5142 -0.15065 0.20595 0.20595 0 0 0 -0.1477 0.04905l-0.01855 0.0127 -0.00095 0.00075 -0.001 0c-0.02195 -0.0044 -0.0874 -0.0161 -0.12595 -0.0222a3.9083 3.9083 0 0 1 -1.7295 2.1755c0.00465 0.011 0.01 0.025 0.01535 0.0403a0.4676 0.4676 0 0 0 0.03345 0.07835l0.001 0.001 -0.0005 0.00145 -0.0083 0.021a0.2074 0.2074 0 0 0 -0.015 0.15455 2.845 2.845 0 0 0 0.2661 0.47585c0.0188 0.02805 0.03785 0.0542 0.0564 0.07955a1.2 1.2 0 0 1 0.10475 0.16c0.0083 0.0156 0.01855 0.0376 0.0276 0.05685l0.01145 0.0242a0.30415 0.30415 0 1 1 -0.54735 0.2588l-0.0112 -0.02275c-0.0093 -0.019 -0.01905 -0.0388 -0.0259 -0.0544a1.25295 1.25295 0 0 1 -0.06055 -0.1829c-0.0083 -0.02975 -0.01685 -0.06075 -0.02685 -0.0925l-0.00295 -0.0083a2.77205 2.77205 0 0 0 -0.2026 -0.4961 0.20885 0.20885 0 0 0 -0.13135 -0.08545l-0.02075 -0.00635 -0.00075 0 -0.00075 -0.00095c-0.005 -0.00855 -0.01685 -0.03055 -0.02975 -0.05375 -0.01175 -0.021 -0.0242 -0.0437 -0.0332 -0.06a3.9434 3.9434 0 0 1 -0.51345 0.15455 3.8794 3.8794 0 0 1 -2.255 -0.16165l-0.0676 0.1221 -0.001 0.0005a0.2405 0.2405 0 0 0 -0.12815 0.062 1.14135 1.14135 0 0 0 -0.168 0.36035c-0.02 0.0586 -0.04 0.11915 -0.06395 0.17845 -0.01025 0.032 -0.0188 0.0635 -0.02685 0.094a1.23735 1.23735 0 0 1 -0.06 0.18115c-0.00635 0.015 -0.01565 0.03345 -0.02465 0.05125l-0.01225 0.0247 -0.00025 0.0012 -0.00095 0.001a0.33865 0.33865 0 0 1 -0.2976 0.19725 0.2742 0.2742 0 0 1 -0.12 -0.0271 0.3213 0.3213 0 0 1 -0.1289 -0.43c0.0044 -0.00855 0.0088 -0.01855 0.0137 -0.0288 0.00855 -0.01855 0.0173 -0.03785 0.025 -0.05225a1.265 1.265 0 0 1 0.105 -0.1611c0.01835 -0.025 0.03735 -0.0513 0.0559 -0.0789a2.91045 2.91045 0 0 0 0.2715 -0.488 0.29445 0.29445 0 0 0 -0.0266 -0.168l0 -0.00095 0 -0.001 0.0537 -0.12865a3.9112 3.9112 0 0 1 -1.73 -2.16l-0.12965 0.0222 -0.00075 -0.0005 -0.0132 -0.00755a0.29805 0.29805 0 0 0 -0.15795 -0.053 2.77235 2.77235 0 0 0 -0.51415 0.15065l-0.00855 0.0032c-0.031 0.01195 -0.06055 0.0244 -0.0891 0.0366a1.24745 1.24745 0 0 1 -0.18065 0.06665c-0.0154 0.00415 -0.0354 0.00855 -0.0547 0.01245l-0.02295 0.005 -0.00245 0.00095 -0.0034 0.001 -0.00245 0.0005 -0.00195 0a0.3039 0.3039 0 1 1 -0.13475 -0.59l0.00195 -0.0005 0.00265 -0.00075 0.001 0 0.0017 -0.00045 0.02345 -0.00565c0.02 -0.005 0.0405 -0.01 0.05665 -0.0129a1.2066 1.2066 0 0 1 0.1904 -0.01785c0.0315 -0.0012 0.0642 -0.0027 0.0979 -0.00535l0.0071 -0.00075A2.777 2.777 0 0 0 3.885 8.96a0.36 0.36 0 0 0 0.1155 -0.1135l0.0122 -0.0159 0.0005 -0.0007 0.0007 0 0.12355 -0.0359a3.88825 3.88825 0 0 1 0.6123 -2.7063l-0.095 -0.085 0 -0.001 -0.0022 -0.0139a0.29915 0.29915 0 0 0 -0.05765 -0.15795 2.80855 2.80855 0 0 0 -0.4458 -0.31325c-0.02925 -0.0171 -0.05785 -0.03245 -0.08565 -0.0471a1.23655 1.23655 0 0 1 -0.16335 -0.09865c-0.0132 -0.00975 -0.0293 -0.02295 -0.0447 -0.03565l-0.0178 -0.0144 -0.0026 -0.00145 -0.00245 -0.00195a0.35225 0.35225 0 0 1 -0.1305 -0.2174 0.28625 0.28625 0 0 1 0.0564 -0.22875A0.29175 0.29175 0 0 1 4 4.7644a0.3613 0.3613 0 0 1 0.2107 0.0796l0.01805 0.01415c0.0166 0.01295 0.035 0.0276 0.0486 0.03905a1.2627 1.2627 0 0 1 0.13355 0.13795c0.02 0.02345 0.04125 0.0476 0.0642 0.07205l0.005 0.005a2.76105 2.76105 0 0 0 0.39945 0.36 0.20795 0.20795 0 0 0 0.155 0.0203l0.0215 -0.00345h0.00095l0.00075 0.0005c0.01785 0.0132 0.0742 0.0537 0.1067 0.0757a3.86365 3.86365 0 0 1 1.96165 -1.12 3.98355 3.98355 0 0 1 0.5408 -0.08325l0.00705 -0.12575 0.0005 -0.0007a0.3243 0.3243 0 0 0 0.09695 -0.1538 2.78895 2.78895 0 0 0 -0.033 -0.53955l-0.00045 -0.0044c-0.00465 -0.0332 -0.0105 -0.065 -0.0164 -0.0957a1.28055 1.28055 0 0 1 -0.02465 -0.19c-0.00045 -0.015 -0.00025 -0.03395 0 -0.05225l0.00025 -0.025 -0.00025 -0.00365 0 -0.00465a0.3044 0.3044 0 1 1 0.6055 0l0.00045 0.03025c0.0005 0.0193 0.00075 0.03955 0.00025 0.055a1.2674 1.2674 0 0 1 -0.02465 0.19c-0.00585 0.03075 -0.0117 0.0625 -0.01635 0.0957l-0.00195 0.01585a2.72395 2.72395 0 0 0 -0.032 0.52835 0.2066 0.2066 0 0 0 0.0808 0.1333l0.0164 0.015 0.00095 0.00075v0.00095c0.00075 0.02175 0.00415 0.0918 0.00685 0.13185a3.895 3.895 0 0 1 1.35865 0.37795 3.9406 3.9406 0 0 1 1.1316 0.825l0.113 -0.0806h0.001l0.0156 0.001a0.2957 0.2957 0 0 0 0.165 -0.0205 2.74425 2.74425 0 0 0 0.39355 -0.355l0.01075 -0.011c0.0227 -0.0239 0.04345 -0.0476 0.0637 -0.0708a1.285 1.285 0 0 1 0.135 -0.13915c0.01315 -0.01145 0.031 -0.025 0.04835 -0.0388l0.0183 -0.0144a0.3044 0.3044 0 1 1 0.3772 0.4736l-0.02175 0.01785c-0.01535 0.0127 -0.0315 0.02585 -0.0442 0.0354a1.23665 1.23665 0 0 1 -0.1633 0.0984c-0.0281 0.01465 -0.05715 0.03 -0.0867 0.04735a2.84445 2.84445 0 0 0 -0.44605 0.31345 0.2076 0.2076 0 0 0 -0.05395 0.1465l-0.0017 0.022v0.00095l-0.0007 0.0005c-0.0081 0.0073 -0.0254 0.02295 -0.0457 0.041s-0.0432 0.0386 -0.0593 0.05325a3.89915 3.89915 0 0 1 0.625 2.6997l0.12 0.035 0.0005 0.0005 0.00855 0.0127a0.3007 0.3007 0 0 0 0.12 0.1167 2.7975 2.7975 0 0 0 0.5315 0.08785l0.0061 0.0005c0.0337 0.00295 0.0664 0.00415 0.09815 0.0054a1.23085 1.23085 0 0 1 0.19 0.0178c0.0156 0.00295 0.03565 0.0078 0.055 0.0127l0.0322 0.0078a0.3215 0.3215 0 0 1 0.25605 0.3697Z" fill="currentColor" strokeWidth="0.5"></path>
			</svg>
		),
	},
	{
		href: "/dashboard/message-stream",
		label: "Message & Stream",
		comingSoon: true,
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
				/>
			</svg>
		),
	},
	{
		href: "/dashboard/networking",
		label: "Networking",
		comingSoon: true,
		icon: (
			<svg
				className="w-5 h-5"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					strokeLinecap="round"
					strokeLinejoin="round"
					strokeWidth={2}
					d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
				/>
			</svg>
		),
	},
];

export function DashboardLayout({ children }: { children: React.ReactNode }) {
	const { user, logout } = useAuth();
	const router = useRouter();
	const [isSidebarOpen, setIsSidebarOpen] = useState(false);
	const [isCollapsed, setIsCollapsed] = useState(false);

	const isActive = (href: string, exact = false) => {
		if (exact) return router.pathname === href;
		return router.pathname.startsWith(href);
	};

	const closeSidebar = () => setIsSidebarOpen(false);
	const toggleCollapse = () => setIsCollapsed(!isCollapsed);

	return (
		<div className="min-h-screen bg-muted/30">
			{/* Header */}
			<header className="sticky top-0 z-40 border-b bg-background">
				<div className="flex h-14 items-center px-4 md:px-6">
					{/* Mobile menu button */}
					<button
						onClick={() => setIsSidebarOpen(!isSidebarOpen)}
						className="mr-3 p-2 rounded-md hover:bg-muted lg:hidden"
						aria-label="Toggle menu"
					>
						<svg
							className="w-5 h-5"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							{isSidebarOpen ? (
								<path
									strokeLinecap="round"
									strokeLinejoin="round"
									strokeWidth={2}
									d="M6 18L18 6M6 6l12 12"
								/>
							) : (
								<path
									strokeLinecap="round"
									strokeLinejoin="round"
									strokeWidth={2}
									d="M4 6h16M4 12h16M4 18h16"
								/>
							)}
						</svg>
					</button>

					<Link
						href="/dashboard"
						className="flex items-center space-x-2"
					>
						<NextImage
							src="/logo.svg"
							alt="Logo"
							width={32}
							height={32}
						/>
						<span className="font-semibold hidden sm:inline">
							Gauas Cloud
						</span>
					</Link>

					<div className="ml-auto flex items-center space-x-2 md:space-x-4">
						<span className="text-sm text-muted-foreground hidden md:inline">
							{user?.email}
						</span>
						<Button variant="ghost" size="sm" onClick={logout}>
							<span className="hidden sm:inline">Sign out</span>
							<svg
								className="w-5 h-5 sm:hidden"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24"
							>
								<path
									strokeLinecap="round"
									strokeLinejoin="round"
									strokeWidth={2}
									d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
								/>
							</svg>
						</Button>
					</div>
				</div>
			</header>

			<div className="flex">
				{/* Mobile overlay */}
				{isSidebarOpen && (
					<div
						className="fixed inset-0 bg-black/50 z-30 lg:hidden"
						onClick={closeSidebar}
					/>
				)}

				{/* Sidebar */}
				<aside
					className={cn(
						"fixed lg:sticky top-14 h-[calc(100vh-3.5rem)] border-r bg-background z-30 transition-all duration-200",
						"lg:translate-x-0",
						isSidebarOpen ? "translate-x-0" : "-translate-x-full",
						isCollapsed ? "lg:w-16 w-64" : "w-64"
					)}
				>
					{/* Toggle button for desktop */}
					<button
						onClick={toggleCollapse}
						className="hidden lg:flex absolute -right-3 top-6 w-6 h-6 items-center justify-center rounded-full border bg-background shadow-sm hover:bg-muted z-10"
						aria-label="Toggle sidebar"
					>
						<svg
							className="w-4 h-4"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							{isCollapsed ? (
								<path
									strokeLinecap="round"
									strokeLinejoin="round"
									strokeWidth={2}
									d="M9 5l7 7-7 7"
								/>
							) : (
								<path
									strokeLinecap="round"
									strokeLinejoin="round"
									strokeWidth={2}
									d="M15 19l-7-7 7-7"
								/>
							)}
						</svg>
					</button>

					<nav className={cn("space-y-1 p-4", isCollapsed && "lg:p-2")}>
						{navItems.map((item) => (
							<Link
								key={item.href}
								href={item.comingSoon ? "#" : item.href}
								className={cn(
									"flex items-center rounded-md text-sm font-medium transition-colors relative group",
									isCollapsed ? "lg:justify-center lg:px-2 lg:py-2.5 px-3 py-2.5 gap-3" : "px-3 py-2.5 justify-between",
									item.comingSoon
										? "text-muted-foreground/50 cursor-not-allowed hover:bg-muted/50"
										: isActive(item.href, item.exact)
										? "bg-primary text-primary-foreground shadow-sm"
										: "text-muted-foreground hover:bg-muted hover:text-foreground"
								)}
								onClick={(e) => {
									if (item.comingSoon) {
										e.preventDefault();
									} else {
										closeSidebar();
									}
								}}
								title={isCollapsed ? item.label : undefined}
							>
								<div className={cn("flex items-center gap-3 min-w-0", isCollapsed && "lg:justify-center")}>
									<span className={cn(item.comingSoon && "opacity-50", "shrink-0")}>
										{item.icon}
									</span>
									<span className={cn("whitespace-nowrap truncate", isCollapsed && "lg:hidden")}>
										{item.label}
									</span>
								</div>
								{item.comingSoon && !isCollapsed && (
									<span className="text-[10px] font-bold px-2 py-0.5 rounded bg-muted text-foreground border shrink-0">
										Soon
									</span>
								)}

								{/* Tooltip for collapsed state - always show on hover */}
								{isCollapsed && (
									<div className="hidden lg:group-hover:block absolute left-full ml-2 px-3 py-2 bg-popover text-popover-foreground border rounded-md shadow-lg text-sm whitespace-nowrap z-50 pointer-events-none">
										<div className={cn(
											"font-medium",
											isActive(item.href, item.exact) ? "text-primary" : ""
										)}>
											{item.label}
										</div>
										{item.comingSoon && (
											<div className="mt-1 text-xs text-muted-foreground">Coming Soon</div>
										)}
									</div>
								)}
							</Link>
						))}
					</nav>
				</aside>

				{/* Main Content */}
				<main className="flex-1 p-4 md:p-6 w-full lg:w-auto">
					{children}
				</main>
			</div>
		</div>
	);
}
